# Oursource Individual Project

## Introduction
As a final assignment for this semester we were tasked to make a to-be-completed feature for another student. This feature should be nothing major, and you should be able to finish it in 1 day. The point of this outsourcing is to see if a project has been correctly setup and is easily expandable. With this also comes that the documentation needs to be up to date and easy to understand. 

The feature I outsourced to Gökay was the ability to see a list of all the effects you have uploaded.

<br>

## Project I worked on
<hr>
The project I had to work on was WorkEthic by [Gökay Atalay](https://github.com/TendezaDev), this project is a task manager. The feature I had to implement was the ability to add a task to a project. His application is inspired by the likes of [Young Creators](https://youngcreators.co), this is a company where people can upload their task and pay for it to be done.

<br>

### The feature
<hr>
The feature I had to implement was the ability to add a task to a project. Gökay already made a springboot project with a Task controller and a React application. This React application had some basic features like showing the tasks that are currently stored in the database. To add this feature to the application I had to add a new page to this React app with a form to add a task, and a new endpoint to the springboot application to handle the request. Another feature I had to implement was the ability to give a task a priority. This priority is either Bueno, NoBueno or MuyBueno.

<br>

## Development
<hr>
The first thing I did was to check out the things that were already implemented and how they were implemented. I did this by forking his repository and checking out the structure of the project. The project is divided into 2 seperate applications, a React application for the frontend and a Springboot application for the backend. I started off by adding the priority to the task in the backend:

<br>

<h2>SpringBoot</h2>

#### TaskPriority Model
I started off by creating a new model in his backend named:"TaskPriority". This model is consists of an id and a value, the id is the primary key that is being autoGenerated by spring boot and the value is the priority of the task. This model is being used to keep track of the different types of priorities a task can have. The model looks like this:

```java
@Entity
@Table(name = "taskPriority")
public class TaskPriority {
    @Getter
    @Setter
    @GeneratedValue
    @Id
    private long id;

    @Getter
    @Setter
    private String value;
}
```

#### Task Model/TaskDTO
After creating the TaskPriority model I had to add a new field to the Task model. This field is a foreign key to the TaskPriority model. This field is called taskPriority and looks like this:
    
```java	
    @Getter
    @Setter
    @ManyToOne(fetch = FetchType.LAZY)
    private TaskPriority taskPriority;
```

I also had to add a new field to the TaskDTO. This field is called: "task_priority_id" and holds the id that the frontend will give to the endpoint. This field looks like this:

```java
    public long task_priority_id;
```

#### TaskController
After adding the new field I had to modify a basic POST endpoint that was already implemented. This endpoint wasn't being used by any part of the application so it was safe to modify it. The endpoint looks like this:
```java
    @PostMapping
    public ResponseEntity<?> create(@RequestBody TaskDTO requestTask) {
        Task newTask = new Task(requestTask.title, requestTask.body, requestTask.userId, requestTask.userName, requestTask.userPicture,em.getReference(TaskPriority.class,requestTask.task_priority_id));
        Task task = taskService.createTask(newTask);

        return ResponseEntity
                .ok()
                .body(task);
    }
```

As you can see I needed to add a Entity Manager to the controller so I could get the priority corresponding to the id that was given by the frontend. After that I just had to call the taskService.createTask method with the new task. This method is being used to create a new task in the database. This method looks like this:

```java
    public Task createTask(Task task) {
        return taskRepository.save(task);
    }
```

### TaskPriorityController
I then also needed a way for the frontend to get the different priorities, so that you would be able to choose one from a dropdown. To do this I created a new controller called TaskPriorityController. This controller has 1 endpoint that returns all the priorities in the database. This controller looks like this:

```java
@RestController
@RequestMapping("/tasks/priorities")
@CrossOrigin(origins = "http://localhost:3000")
public class TaskPriorityController {


    @Autowired
    private ITaskPriorityService priorityService;

    @GetMapping
    public ResponseEntity<?> index() {
        List<TaskPriority> priorities = priorityService.getAllPriorities();

        return ResponseEntity
                .ok()
                .body(priorities);
    }
}
```

As you can see I also needed to add an new Service, repository and Service interface to the project. 
The task priority repository looks like this:

```java
public interface TaskPriorityRepository extends JpaRepository<TaskPriority,Long> {
}

```
It implements the JpaRepository interface so that it can be used to get all the priorities from the database. The TaskPriorityService looks like this:

```java
@Service
public class TaskPriorityService implements ITaskPriorityService {
    @Autowired
    TaskPriorityRepository repository;

    public List<TaskPriority> getAllPriorities(){
        return repository.findAll();
    }
}
```
The TaskPriorityService has 1 method that returns all the priorities from the database. This method is being called through the interface by the TaskPriorityController. The TaskPriorityService interface looks like this:

```java
public interface ITaskPriorityService {
    public List<TaskPriority> getAllPriorities();
}
```

<h2>React</h2>
First off I added a new Link to the navbar and a new Route to the App.js file. So that you can navigate to the new page. The Link looks like this:

```javascript
<Link to="/create/task">Create Task</Link>
```

The Route looks like this:

```javascript
<Route path='/create/task' element={<CreateTask />} />
```

After that I created a new page component called CreateTask.js. This component is being rendered when you navigate to the /create/task route. The JSX component looks like this:

```javascript
        <>
            <br></br>
            <h2>Create task</h2>
            <br></br>
            <div className={styles.WrappingContainer}>
                <div className={styles.Card}>
                    <div className={styles.formControl}>
                        <FormControl isRequired>
                            <FormLabel>Task Title</FormLabel>
                            <Input ref={Title} borderColor={"black"} placeholder='Task title' />
                        </FormControl>
                    </div>
                    <div className={styles.formControl}>
                        <FormControl isRequired>
                            <FormLabel>Task Body</FormLabel>
                            <Textarea ref={Body} borderColor={"black"} placeholder='Body' />
                        </FormControl>
                    </div>
                    <div className={styles.formControl}>
                        <FormControl isRequired>
                            <FormLabel>Task Priority</FormLabel>
                            <Select borderColor={"black"} onChange={(e) => {
                                console.log(e.target.value)
                                setPriority(e.target.value)
                            }}>
                                {priorities.map((priority, i) => {
                                    if (i === 0 && Priority === "") {
                                        setPriority(priority.id)
                                    }
                                    return (
                                        <option key={priority.id} value={priority.id}>{priority.value}</option>
                                    )
                                })}
                            </Select>
                        </FormControl>
                    </div>
                    <Button
                        onClick={onSubmit}
                        ml={"auto"}
                        mr={"auto"}
                        mt={4}
                        width='50%'
                        colorScheme='teal'
                        type='submit'
                    >
                        Submit
                    </Button>
                </div>
            </div>
        </>
```

For the logic of this component I added a new UseEffect to get all the priorities from the backend. This useEffect looks like this:

```javascript
    useEffect(() => {
        Service.getPriorities().then((res) => {
            setPriorities(res.data)
        })
    }, [])
```
And I also created some UseRef's and UseState's to store the values of the form. The UseRef's look like this:

```javascript
    const [priorities, setPriorities] = useState([])
    const Title = useRef("")
    const Body = useRef("")
    const [Priority, setPriority] = useState("")
```
To get all the data from the User that I need I used the userService.getUserSession() method made by Gökay. This method returns a string with all user data. I then parsed this string to a JSON object. This method looks like this:

```javascript
      const user = JSON.parse(userService.getUserSession());
```
Now that I have implemented the form and can get all the data I need I made an onSubmit method. This method looks like this:

```javascript
    function onSubmit() {
        const data = {
            title: Title.current.value,
            body: Body.current.value,
            userId: user.sub,
            userName: user.name,
            userPicture: user.picture,
            task_priority_id: Priority
        }
        Service.postTask(data).then((res) => {
            navigate("/tasks")
        })
    }
```

To post the data to the backend I created a new service called the TaskService. This service has 2 methods. The first one is for getting all the priorities from the backend and the second one is for posting the new task. The TaskService looks like this:

```javascript
import axios from "axios";

class TaskService {

    getPriorities() {
        return axios.get("http://localhost:8080/tasks/priorities");
    }

    postTask(task) {
        return axios.post("http://localhost:8080/tasks", task);
    }
}
export default TaskService;
```

Now that all this stuff is done I can create a new task by filling out the form in the frontend and clicking the submit button. 

## The oursourced result
The feature that has been outsourced by me has been implemented and is working. The user can now view the effects he has uploaded. His code also passed all tests and was merged into the main branch. He kept the code clean and made sure to follow the structure which was already there.
